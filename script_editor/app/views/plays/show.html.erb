<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body style = "background-color: #white">
    <p id="notice"></p>

<h2><%= @play.title %></h2>
<body class = "script-main">
    <% @acts.each do |act| %>
      <h3> Act <%= act.number %> </h3>
      <% rscenes = Scene.includes(:act).where(:act_id => act.id).order(:number) %>
      <% rscenes.each do |scene| %>
        <h4> Scene <%= scene.number %> </h4>
        <% rlines = Line.includes(:scene).where(:scene_id => scene.id).order(:number) %>
        <% rlines.each do |line| %>
          <% if line.isStage %>
              <p><button class ="word"><i><%= line.words.first.text %></i> </button></p>
          <% else %>
            <% words = Word.joins(:cuts).select("words.*, cuts.edit_id").where(:line_id => line.id).order(:place) %>

            <p>
              <strong> <%= line.speaker %> </strong>
              <%= line.number %>
              <% words.each do |word| %>
                <% if word.edit_id == @edit.id %>
                  <button class="word">CUT</button>
                <% else %>
                  <button class ="word">
                  <%= word.text %>
                  </button>
                <% end %>
              <% end %>
            </p>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
</body>

<script>
    document.querySelector(".script-main").addEventListener("mousedown", drag, false);
    document.querySelector(".script-main").addEventListener("mouseover", doCut, false);
    document.querySelector(".script-main").addEventListener("mousedown", doCut, false);
    document.querySelector(".script-main").addEventListener("mouseup", lift, false);
    var mousedrag = false;
    var currId = 0;
    function drag(e)
    {
        mousedrag = true;
    }
    function lift(e)
    {
        mousedrag = false;
        currId = 0;
    }

    // all words will need to be printed within the div class "script-main"
    function doCut(e) {
        var clickedItem = e.target;
        // act
        if (clickedItem.getAttribute("class") == "acthead") {
        //    if (clickedItem.tagName.toLowerCase() == "button") {
        //
        //        // Don't cut Acts
        //        var entireAct = document.getElementById("Div" + clickedItem.id);
        //        var allChildren = entireAct.getElementsByTagName("button");
        //        if (clickedItem.dataset.cut.toLowerCase() == "false") {
        //            for (var i = 0; i < allChildren.length; i++) {
        //                allChildren[i].style.color = "#D3D3D3";
        //                allChildren[i].style.textDecoration = "line-through";
        //                allChildren[i].dataset.cut = "true";
        //            }
        //            //clickedItem.style.color = "#D3D3D3";
        //            //clickedItem.style.textDecoration = "line-through";
        //            clickedItem.dataset.cut = "true";
        //        }
        //        // perform uncut
        //        else {
        //            for (var i = 0; i < allChildren.length; i++) {
        //                allChildren[i].style.color = "#000000";
        //                allChildren[i].style.textDecoration = "none";
        //                allChildren[i].dataset.cut = "false";
        //            }
        //            // clickedItem.style.color = "#000000";
        //            // clickedItem.style.textDecoration = "none";
        //            clickedItem.dataset.cut = "false";
        //        }
        //    }
        }
        // scene
        else if (clickedItem.getAttribute("class") == "scenehead") {
        //    if (clickedItem.tagName.toLowerCase() == "button") {
        //        // perform cut
        //        var entireScene = document.getElementById("Div" + clickedItem.id);
        //        var allChildren = entireScene.getElementsByTagName("button");
        //        if (clickedItem.dataset.cut.toLowerCase() == "false") {
        //            for (var i = 0; i < allChildren.length; i++) {
        //                allChildren[i].style.color = "#D3D3D3";
        //                allChildren[i].style.textDecoration = "line-through";
        //                allChildren[i].dataset.cut = "true";
        //            }
        //            //clickedItem.style.color = "#D3D3D3";
        //            //clickedItem.style.textDecoration = "line-through";
        //            clickedItem.dataset.cut = "true";
        //        }
        //        // perform uncut
        //        else {
        //            for (var i = 0; i < allChildren.length; i++) {
        //                allChildren[i].style.color = "#000000";
        //                allChildren[i].style.textDecoration = "none";
        //                allChildren[i].dataset.cut = "false";
        //            }
        //            //clickedItem.style.color = "#000000";
        //            //clickedItem.style.textDecoration = "none";
        //            clickedItem.dataset.cut = "false";
        //        }
        //    }
        }
        // stage
        else if (clickedItem.getAttribute("class") == "stage") {
            if (clickedItem.tagName.toLowerCase() == "button") {
                if (mousedrag && !e.shiftKey) {
                    clickedItem.style.color = "#D3D3D3";
                    clickedItem.style.textDecoration = "line-through";
                    clickedItem.dataset.cut = "true";
                }
                else if(e.shiftKey && mousedrag) {
                    clickedItem.style.color = "#000000";
                    clickedItem.style.textDecoration = "none";
                    clickedItem.dataset.cut = "false";
                }
            }
        }
        // line
        else if (clickedItem.getAttribute("class") == "word" || clickedItem.getAttribute("class") == "punc") {
            if (clickedItem.tagName.toLowerCase() == "button") {
                if (mousedrag && !e.shiftKey) {
                    console.log("What's up youtube");
                    clickedItem.style.color = "#D3D3D3";
                    clickedItem.style.textDecoration = "line-through";
                    clickedItem.dataset.cut = "true";
                    if(currId != 0)
                    {
                        console.log(clickedItem.id.to_s);
                        /*var intId = numeralize(clickedItem.id);
                        console.log(intId);
                        //wrap(id);
                        currId = intId;*/
                    }
                    else
                    {
                        console.log(clickedItem.id.to_s);
                        /*var intId = numeralize(clickedItem.id);
                        console.log(intId);
                        currId = intId;*/
                    }
                }
                else if(e.shiftKey && mousedrag){
                    clickedItem.style.color = "#000000";
                    clickedItem.style.textDecoration = "none";
                    clickedItem.dataset.cut = "false";
                    if(currId != 0)
                    {
                        console.log(clickedItem.id.to_s);
                        /*var intId = numeralize(clickedItem.id);
                        console.log(intId);
                        //wrap(id);
                        currId = intId;*/
                    }
                    else
                    {
                        console.log(clickedItem.id.to_s);
                        /*var intId = numeralize(clickedItem.id);
                        console.log(intId);
                        currId = intId;*/
                    }
                }
            }
        }
    };
</script>

</body></html>
